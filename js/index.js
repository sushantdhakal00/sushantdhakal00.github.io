var container,particle,canvas,mouse,stats,list,ctx,tog,man,dx,dy,mx,my,d,t,f,a,b,i,n,w,h,p,s,r,c,NUM_PARTICLES=(ROWS=25)*(COLS=450),THICKNESS=Math.pow(80,2),SPACING=3,MARGIN=100,COLOR=252,DRAG=.35,EASE=.15;function init(){for(container=document.getElementById("container"),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),man=!1,tog=!0,list=[],w=canvas.width=COLS*SPACING+2*MARGIN,h=canvas.height=ROWS*SPACING+2*MARGIN,container.style.marginLeft=Math.round(-.5*w)+"px",container.style.marginTop=Math.round(-.9*h)+"px",i=0;i<NUM_PARTICLES;i++)(p=Object.create(particle)).x=p.ox=MARGIN+SPACING*(i%COLS),p.y=p.oy=MARGIN+SPACING*Math.floor(i/COLS),list[i]=p;container.addEventListener("mousemove",(function(t){bounds=container.getBoundingClientRect(),mx=t.clientX-bounds.left,my=t.clientY-bounds.top,man=!0})),"function"==typeof Stats&&document.body.appendChild((stats=new Stats).domElement),container.appendChild(canvas)}function step(){if(stats&&stats.begin(),tog=!tog)for(man||(t=.001*+new Date,mx=.5*w+Math.cos(2.1*t)*Math.cos(.9*t)*w*.45,my=.5*h+Math.sin(3.2*t)*Math.tan(Math.sin(.8*t))*h*.45),i=0;i<NUM_PARTICLES;i++)p=list[i],d=(dx=mx-p.x)*dx+(dy=my-p.y)*dy,f=-THICKNESS/d,d<THICKNESS&&(t=Math.atan2(dy,dx),p.vx+=f*Math.cos(t),p.vy+=f*Math.sin(t)),p.x+=(p.vx*=DRAG)+(p.ox-p.x)*EASE,p.y+=(p.vy*=DRAG)+(p.oy-p.y)*EASE;else{for(b=(a=ctx.createImageData(w,h)).data,i=0;i<NUM_PARTICLES;i++)p=list[i],b[n=4*(~~p.x+~~p.y*w)]=b[n+1]=b[n+2]=COLOR,b[n+3]=255;ctx.putImageData(a,0,0)}stats&&stats.end(),requestAnimationFrame(step)}particle={vx:0,vy:0,x:0,y:0},init(),step();
